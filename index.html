<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HTML Literal & Parsed Preview PWA</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f62fe" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f7fb;
    }
    textarea {
      width: 100%;
      height: 150px;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    #previewWrapper {
      margin-top: 15px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    pre, .rendered {
      background: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      white-space: pre-wrap;
      word-wrap: break-word;
      flex: 1 1 45%;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      user-select: text;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .rendered {
      font-family: Arial, sans-serif;
    }
    .controls {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 8px 15px;
      border: none;
      background: #0f62fe;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background: #0b4dcc;
    }
    #installBtn {
      margin-left: auto;
      display: none;
    }
    h2 {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <h2>HTML Code Literal & Parsed Preview</h2>

  <textarea id="codeInput" placeholder="Write or paste HTML code here...">&lt;h2&gt;Hello World&lt;/h2&gt;</textarea>

  <div class="controls">
    <button id="copyBtn">Select & Copy Literal</button>
    <button id="clearBtn">Clear</button>
    <button id="parseBtn">Parse & Render</button>
    <button id="installBtn">Install App</button>
  </div>

  <div id="previewWrapper">
    <div>
      <h3>Literal Preview</h3>
      <pre id="codePreview"></pre>
    </div>
    <div>
      <h3>Rendered Preview</h3>
      <div id="renderedPreview" class="rendered"></div>
    </div>
  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }

  const textarea = document.getElementById('codeInput');
  const codePreview = document.getElementById('codePreview');
  const renderedPreview = document.getElementById('renderedPreview');
  const copyBtn = document.getElementById('copyBtn');
  const clearBtn = document.getElementById('clearBtn');
  const parseBtn = document.getElementById('parseBtn');
  const installBtn = document.getElementById('installBtn');

  function escapeHTML(str) {
    return str.replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#39;");
  }

  function updateLiteralPreview() {
    codePreview.textContent = escapeHTML(textarea.value);
  }

  // Initial literal preview
  updateLiteralPreview();
  renderedPreview.innerHTML = ''; // empty initially

  // Copy literal preview to clipboard
  copyBtn.addEventListener('click', () => {
    const range = document.createRange();
    range.selectNodeContents(codePreview);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);

    try {
      document.execCommand('copy');
      alert('Copied literal code to clipboard!');
      sel.removeAllRanges();
    } catch {
      alert('Copy failed. Please try manual selection.');
    }
  });

  // Clear textarea and previews
  clearBtn.addEventListener('click', () => {
    textarea.value = '';
    updateLiteralPreview();
    renderedPreview.innerHTML = '';
    textarea.focus();
  });

  // Parse & render HTML from textarea
  parseBtn.addEventListener('click', () => {
    renderedPreview.innerHTML = textarea.value;
  });

  // Update literal preview as user types
  textarea.addEventListener('input', () => {
    updateLiteralPreview();
    // Clear rendered preview on input for safety
    renderedPreview.innerHTML = '';
  });

  // Install button logic
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = 'inline-block';
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    if (choice.outcome === 'accepted') {
      console.log('User accepted the install prompt');
    } else {
      console.log('User dismissed the install prompt');
    }
    deferredPrompt = null;
    installBtn.style.display = 'none';
  });

  window.addEventListener('appinstalled', () => {
    console.log('App installed');
    installBtn.style.display = 'none';
  });
</script>

</body>
</html>
